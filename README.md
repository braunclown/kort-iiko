# Kört-iiko

Kört-iiko &ndash; это интегрированное с iiko веб-приложение для организаций общественного питания, 
которое формирует заказы на приготовление требуемого количества блюд.

## Запуск приложения в режиме разработчика

Приложение представляет собой обычный Maven-проект. Чтобы запустить его, 
задайте настройки в файле [`application.properties`](src/main/resources/application.properties) 
(см. пункт 4 в разделе "Развёртывание")
и, находясь в папке проекта, введите в командной строке `mvnw` (Windows cmd) или `./mvnw` (Mac, Linux, Windows PowerShell), 
а затем откройте https://localhost:8443 в браузере.

Как и любой Maven-проект, Kört-iiko можно открыть в популярных IDE. 
Подробнее по ссылке: [Как импортировать Vaadin-приложения в различные IDE](https://vaadin.com/docs/latest/guide/step-by-step/importing) (Eclipse, IntelliJ IDEA, NetBeans и VS Code).

## Сборка

Чтобы создать продакшн-сборку, введите в командной строке `mvnw clean package -Pproduction` (Windows cmd)
или `./mvnw clean package -Pproduction` (Mac, Linux, Windows PowerShell).
Так в папке `target` вы получите готовый к развёртыванию JAR-файл.

## Развёртывание
### 1. Создайте Telegram-бота
1.1. Начните диалог с Telegram-ботом BotFather;\
1.2. Введите команду `/newbot`, укажите название бота и его имя пользователя;\
1.3. Введите команду `/setcommands` и отправьте следующий список команд вашего бота:
```text
start - Начать чат
auth - Авторизоваться как админ
```

### 2. Создайте БД
2.1. Создайте в PostgreSQL пустую БД;\
2.2. Предоставьте права доступа к БД пользователю, от имени которого к ней будет подключаться приложение;\
2.3. Обеспечьте возможность подключения к БД по имени пользователя и паролю.

### 3. Подготовьте сервер
3.1. Установите на сервере JDK 21 (или более позднюю версию);\
3.2. Загрузите на сервер JAR-файл приложения;\
3.3. Чтобы обеспечить шифрование данных, загрузите на сервер сертификаты в виде PKCS#12-файла.

### 4. Создайте конфигурационный файл
4.1. В папке, где находится JAR-файл, создайте папку `config` 
и положите в неё файл [`application.properties`](src/main/resources/application.properties);\
4.2. Настройте ваше приложение, указав в файле `application.properties` значения следующих параметров:

| Параметр                      | Значение                                                                                        |
|-------------------------------|-------------------------------------------------------------------------------------------------|
| spring.datasource.url         | Строка подключения к БД                                                                         |
| spring.datasource.username    | Имя пользователя для подключения к БД                                                           |
| spring.datasource.password    | Пароль для подключения к БД                                                                     |
| iiko.server-address           | Адрес вашего сервера iiko                                                                       |
| iiko.username                 | Имя пользователя iiko                                                                           |
| iiko.password                 | Пароль пользователя iiko                                                                        |
| telegram.bot-name             | Имя пользователя вашего Telegram-бота                                                           |
| telegram.bot-token            | Токен доступа к боту (должен быть получен на шаге 1.2)                                          |
| server.ssl.key-store          | Путь к PKCS#12-файлу, например, `/home/user/cert.p12`                                           |
| server.ssl.key-store-password | Пароль для PKCS#12-файла                                                                        |
| server.ssl.key-alias          | Алиас для PKCS#12-файла                                                                         |
| settings.timezone             | Часовой пояс сервера (список поясов см. в [спецификации IANA](https://www.iana.org/time-zones)) |


### 5. Запустите приложение
Запустите JAR-файл, например, `java -jar kort-iiko-1.0-SNAPSHOT.jar`
